<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

<script>
    // Configuration
    const TELEGRAM_TOKEN = '8214991980:AAEMAzT-U0sBaypTIBaxZHy2GLGr_Qczhqc';
    const CHAT_ID = '909942121';

    const firebaseConfig = {
        apiKey: "AIzaSyDvoKFy1pdPB1JmvRRd4G_bL4Z5lRcwuZI",
        databaseURL: "https://sos-alert-system-56f54-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ... (keep your existing timer and signal-bar functions) ...

    function sendSOS() {
        document.getElementById('status').innerText = "ðŸ“¡ SENDING...";
        
        navigator.geolocation.getCurrentPosition((position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const acc = Math.round(position.coords.accuracy);

            // HIGHLIGHT: Data object to be shared
            const alertData = {
                lat: lat,
                lng: lng,
                accuracy: acc,
                timestamp: Date.now()
            };

            // 1. Send to Firebase (COMMAND CENTER)
            // HIGHLIGHT: Added .then() to verify Firebase actually received it
            db.ref('alerts').push(alertData)
                .then(() => console.log("Firebase Success"))
                .catch((e) => alert("Firebase Error: " + e.message));

            // 2. Send to Telegram (MOBILE)
            const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;
            const message = `ðŸš¨ *AALAM SOS* ðŸš¨\nAcc: ${acc}m\nLoc: ${mapLink}`;
            
            fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(message)}&parse_mode=Markdown`);

            document.getElementById('status').innerText = "âœ… SENT TO COMMAND";
        }, (err) => {
            alert("Location Error: " + err.message);
        }, { enableHighAccuracy: true });
    }
    
    // ... (rest of your event listeners) ...
</script>
