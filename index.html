<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

<script>
    // Initialize Firebase in Sender
    const firebaseConfig = {
        apiKey: "AIzaSyDvoKFy1pdPB1JmvRRd4G_bL4Z5lRcwuZI",
        databaseURL: "https://sos-alert-system-56f54-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // HIGHLIGHT: Updated sendSOS to include Firebase push
    function sendSOS() {
        document.getElementById('status').innerText = "ðŸ“¡ SENDING...";
        
        navigator.geolocation.getCurrentPosition((position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const acc = Math.round(position.coords.accuracy);

            // 1. Send to Firebase (For Command Center)
            db.ref('alerts').push({
                lat: lat,
                lng: lng,
                battery: 100, // You can add actual battery logic later
                timestamp: Date.now(),
                callerId: "USER_01" 
            });

            // 2. Send to Telegram (For Notifications)
            const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;
            const message = `ðŸš¨ *AALAM SOS* ðŸš¨\nAcc: ${acc}m\nLoc: ${mapLink}`;
            fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(message)}&parse_mode=Markdown`);

            document.getElementById('status').innerText = "âœ… ALERT ACTIVE";
        }, (err) => alert(err.message), { enableHighAccuracy: true });
    }
</script>
