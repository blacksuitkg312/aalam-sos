<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AALAM SOS SENDER</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; margin: 0; overflow: hidden; touch-action: manipulation; }
        .header { background: #1a1a1a; padding: 30px 20px; border-bottom: 2px solid #333; }
        .sos-container { height: 50vh; display: flex; align-items: center; justify-content: center; position: relative; }
        .sos-btn {
            width: 200px; height: 200px; background: radial-gradient(#e53935, #8e0000);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 40px; font-weight: bold; border: none; color: white;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.4); cursor: pointer;
            user-select: none; -webkit-tap-highlight-color: transparent; z-index: 10;
        }
        svg { position: absolute; transform: rotate(-90deg); pointer-events: none; }
        circle { fill: none; stroke: #ff0000; stroke-width: 8; stroke-dasharray: 628; stroke-dashoffset: 628; }
        #accuracy-info { font-size: 12px; color: #888; margin-top: 15px; }
        .signal-bar { display: inline-block; width: 6px; background: #333; margin: 0 2px; transition: 0.3s; border-radius: 2px; }
        .good { background: #4CAF50 !important; }
        .fair { background: #FFC107 !important; }
        .poor { background: #F44336 !important; }
    </style>
</head>
<body>
    <div class="header">
        <div style="color:red; font-size: 30px;">üõ°Ô∏è</div>
        <h2 style="letter-spacing: 2px; margin: 5px 0;">AALAM SECURITY</h2>
    </div>

    <div class="sos-container">
        <svg width="240" height="240">
            <circle id="progress-ring" cx="120" cy="120" r="100"></circle>
        </svg>
        <button class="sos-btn" id="sos-trigger">SOS</button>
    </div>

    <p id="status" style="color: #ff3e3e; font-weight: bold; margin:0;">HOLD FOR 3 SECONDS</p>

    <div id="accuracy-info">
        SIGNAL: <span id="signal-text">SYNCING GPS...</span>
        <div id="bars" style="margin-top:8px;">
            <div class="signal-bar" style="height:8px"></div>
            <div class="signal-bar" style="height:12px"></div>
            <div class="signal-bar" style="height:16px"></div>
        </div>
    </div>

    <script>
        const TELEGRAM_TOKEN = '8214991980:AAF7B8fUkyOULoXf0ySrwX6zbPQBz3qpJvo';
        const CHAT_ID = '909942121';

        let timer, progress = 0;
        const btn = document.getElementById('sos-trigger');
        const ring = document.getElementById('progress-ring');

        function startGpsWatch() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition((pos) => {
                    const acc = pos.coords.accuracy;
                    const text = document.getElementById('signal-text');
                    const bars = document.querySelectorAll('.signal-bar');
                    bars.forEach(b => b.className = 'signal-bar');
                    if (acc < 30) { 
                        text.innerText = "EXCELLENT (" + Math.round(acc) + "m)";
                        bars.forEach(b => b.classList.add('good'));
                    } else if (acc < 100) {
                        text.innerText = "FAIR (" + Math.round(acc) + "m)";
                        bars[0].classList.add('fair'); bars[1].classList.add('fair');
                    } else {
                        text.innerText = "POOR (" + Math.round(acc) + "m)";
                        bars[0].classList.add('poor');
                    }
                }, null, { enableHighAccuracy: true });
            }
        }

        function startHold(e) {
            e.preventDefault();
            if (timer) clearInterval(timer);
            timer = setInterval(() => {
                progress += 2;
                ring.style.strokeDashoffset = 628 - (628 * progress / 100);
                if (progress >= 100) {
                    clearInterval(timer);
                    sendSOS();
                    resetProgress();
                }
            }, 60);
        }

        function resetProgress() {
            clearInterval(timer);
            progress = 0;
            ring.style.strokeDashoffset = 628;
        }

        function sendSOS() {
            document.getElementById('status').innerText = "üì° SENDING...";
            navigator.geolocation.getCurrentPosition((position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const acc = Math.round(position.coords.accuracy);
                
                // HIGHLIGHT: Fixed variable syntax and added a searchable "Coords:" string
                const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;
                const message = `üö® *AALAM SOS ALERT* üö®\n\n*Accuracy:* ${acc}m\n*Coords:* ${lat},${lng}\n[View on Map](${mapLink})`;

                fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(message)}&parse_mode=Markdown`)  
                .then(() => {
                    document.getElementById('status').innerText = "‚úÖ SENT TO TELEGRAM";
                    setTimeout(() => { document.getElementById('status').innerText = "HOLD FOR 3 SECONDS"; }, 3000);
                });
            }, (error) => {
                alert("Location Error: " + error.message);
            }, { enableHighAccuracy: true });
        }

        window.addEventListener('touchstart', startGpsWatch, {once: true});
        window.addEventListener('mousedown', startGpsWatch, {once: true});
        btn.addEventListener('touchstart', startHold);
        btn.addEventListener('mousedown', startHold);
        window.addEventListener('touchend', resetProgress);
        window.addEventListener('mouseup', resetProgress);
    </script>
</body>
</html>
